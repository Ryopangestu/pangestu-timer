<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer Management System</title>
    <link rel="icon" href="logo.png" type="image/png">
    
    <!-- CSS dan JavaScript Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <style>
        /* ================= CSS UTAMA ================= */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .main-container {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin: 1rem auto;
            max-width: 1200px;
        }
        
        .dark .main-container {
            background-color: #1f2937;
            color: #f3f4f6;
        }
        
        /* Style untuk tabel */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: center;
            border: 1px solid #e5e7eb;
        }
        
        th {
            background-color: #f3f4f6;
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.05em;
        }
        
        .dark th {
            background-color: #111827;
            color: #f3f4f6;
            border-color: #4b5563;
        }
        
        .dark td {
            background-color: #1f2937;
            color: #f3f4f6;
            border-color: #4b5563;
        }
        
        /* Style untuk tombol */
        .btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-weight: 500;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-primary {
            background-color: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #2563eb;
        }
        
        .btn-danger {
            background-color: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background-color: #dc2626;
        }
        
        .btn-success {
            background-color: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #059669;
        }
        
        /* Style untuk input */
        .input-field {
            border: 1px solid #d1d5db;
            border-radius: 0.375rem;
            padding: 0.5rem;
            width: 100%;
            background-color: white;
        }
        
        .dark .input-field {
            border-color: #4b5563;
            background-color: #374151;
            color: #f3f4f6;
        }
        
        /* Style khusus untuk timer */
        .timer-display {
            font-family: monospace;
            font-size: 1.1rem;
            font-weight: bold;
            color: #047857;
            background-color: #ecfdf5;
            border: 2px solid #10b981;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            display: inline-block;
            min-width: 100px;
            text-align: center;
        }
        
        .dark .timer-display {
            color: #d1fae5;
            background-color: #064e3b;
            border-color: #6ee7b7;
        }
        
        /* Style untuk notifikasi */
        .notification {
            animation: fadeIn 0.5s ease-in-out;
            border: 2px solid #ef4444;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            background-color: #fee2e2;
            color: #b91c1c;
            font-weight: bold;
            margin: 0.25rem;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .dark .notification {
            border-color: #fca5a5;
            background-color: #7f1d1d;
            color: #fecaca;
        }
        
        .notification:hover {
            transform: scale(1.05);
        }
        
        /* Animasi */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            table {
                display: block;
                overflow-x: auto;
            }
            
            .btn {
                padding: 0.5rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-r from-green-500 to-green-700">
    <div class="main-container">
        <!-- Header dan Informasi Waktu -->
        <div class="header-section text-center mb-6">
            <h1 class="text-2xl font-bold mb-2">Timer Management System</h1>
            <div id="current-time" class="text-lg"></div>
        </div>
        
        <!-- Tabel Timer Utama -->
        <div class="timer-section mb-8">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Daftar Timer</h2>
                <button id="add-timer-btn" class="btn btn-primary">
                    + Tambah Timer
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table id="timer-table">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama Timer</th>
                            <th>Durasi</th>
                            <th>Waktu Tersisa</th>
                            <th>Selesai Pada</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="timer-body">
                        <!-- Data timer akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Tabel Watchlist -->
        <div class="watchlist-section">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">Daftar Watchlist</h2>
                <button id="add-watchlist-btn" class="btn btn-primary">
                    + Tambah Watchlist
                </button>
            </div>
            
            <div class="overflow-x-auto">
                <table id="watchlist-table">
                    <thead>
                        <tr>
                            <th>No</th>
                            <th>Nama Task</th>
                            <th>Deadline</th>
                            <th>Status</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody id="watchlist-body">
                        <!-- Data watchlist akan diisi oleh JavaScript -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Konverter Waktu -->
        <div class="converter-section mt-8 p-4 bg-gray-50 rounded-lg dark:bg-gray-800">
            <h3 class="text-lg font-bold mb-3">Konverter Waktu WIB ⇄ UTC</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block mb-1">Waktu WIB</label>
                    <input type="time" id="wib-time" class="input-field" step="1">
                    <button id="wib-to-utc" class="btn btn-success w-full mt-2">
                        WIB → UTC
                    </button>
                </div>
                <div class="flex items-center justify-center">
                    <span class="text-2xl">⇄</span>
                </div>
                <div>
                    <label class="block mb-1">Waktu UTC</label>
                    <input type="time" id="utc-time" class="input-field" step="1">
                    <button id="utc-to-wib" class="btn btn-success w-full mt-2">
                        UTC → WIB
                    </button>
                </div>
            </div>
            <div class="text-sm text-gray-500 mt-2 dark:text-gray-400">
                * WIB (Waktu Indonesia Barat) = UTC+7
            </div>
        </div>
    </div>

    <!-- ================= JAVASCRIPT UTAMA ================= -->
    <script>
        // Konfigurasi Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDXjv3Yg8RJvxCrYYZvMjpEKSdxcshynTo",
            authDomain: "pangestu-timer.firebaseapp.com",
            databaseURL: "https://pangestu-timer-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "pangestu-timer",
            storageBucket: "pangestu-timer.appspot.com",
            messagingSenderId: "423055274704",
            appId: "1:423055274704:web:3e9e438bc18439012364d5",
            measurementId: "G-0249BJFL8T"
        };

        // Inisialisasi Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Variabel Global
        const activeTimers = {};
        const activeWatchlists = {};
        let timerCount = 0;
        let watchlistCount = 0;

        // ================= FUNGSI UTILITAS =================
        function formatTime(seconds) {
            const hrs = Math.floor(seconds / 3600);
            const mins = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${String(hrs).padStart(2, '0')}:${String(mins).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function formatDateTime(date) {
            const options = {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                timeZone: 'Asia/Jakarta'
            };
            return date.toLocaleDateString('id-ID', options);
        }

        function showAlert(title, message, icon = 'success') {
            Swal.fire({
                title: title,
                text: message,
                icon: icon,
                timer: 3000,
                timerProgressBar: true,
                showConfirmButton: false,
                position: 'top-end'
            });
        }

        // ================= FUNGSI TIMER =================
        function createTimerRow(timerId, timerData) {
            const row = document.createElement('tr');
            row.id = `timer-${timerId}`;
            
            const remainingTime = timerData.duration - Math.floor((Date.now() - timerData.startTime) / 1000);
            const finishTime = new Date(timerData.startTime + timerData.duration * 1000);
            
            row.innerHTML = `
                <td class="text-center">${++timerCount}</td>
                <td>
                    <input type="text" class="input-field timer-name" value="${timerData.name || ''}">
                </td>
                <td class="text-center">${formatTime(timerData.duration)}</td>
                <td class="text-center">
                    <span class="timer-display">${formatTime(remainingTime > 0 ? remainingTime : 0)}</span>
                </td>
                <td class="text-center">${formatDateTime(finishTime)}</td>
                <td class="text-center space-x-2">
                    <button class="btn btn-success start-btn" ${timerData.isRunning ? 'disabled' : ''}>Start</button>
                    <button class="btn btn-danger stop-btn" ${!timerData.isRunning ? 'disabled' : ''}>Stop</button>
                    <button class="btn btn-danger delete-btn">Hapus</button>
                </td>
            `;
            
            // Setup event listeners
            row.querySelector('.start-btn').addEventListener('click', () => startTimer(timerId));
            row.querySelector('.stop-btn').addEventListener('click', () => stopTimer(timerId));
            row.querySelector('.delete-btn').addEventListener('click', () => deleteTimer(timerId));
            row.querySelector('.timer-name').addEventListener('change', (e) => updateTimerName(timerId, e.target.value));
            
            if (timerData.isRunning) {
                startTimerUI(timerId, remainingTime);
            }
            
            return row;
        }

        function startTimerUI(timerId, initialDuration) {
            if (activeTimers[timerId]) {
                clearInterval(activeTimers[timerId]);
            }
            
            const timerElement = document.querySelector(`#timer-${timerId} .timer-display`);
            let remaining = initialDuration;
            
            activeTimers[timerId] = setInterval(() => {
                remaining--;
                if (remaining <= 0) {
                    clearInterval(activeTimers[timerId]);
                    timerElement.textContent = "00:00:00";
                    showAlert("Timer Selesai", `Timer ${timerId} telah selesai`, 'info');
                } else {
                    timerElement.textContent = formatTime(remaining);
                }
            }, 1000);
        }

        // ================= FUNGSI WATCHLIST =================
        function createWatchlistRow(watchlistId, watchlistData) {
            const row = document.createElement('tr');
            row.id = `watchlist-${watchlistId}`;
            
            const deadlineDate = watchlistData.deadline ? new Date(watchlistData.deadline) : null;
            
            row.innerHTML = `
                <td class="text-center">${++watchlistCount}</td>
                <td>
                    <input type="text" class="input-field watchlist-name" value="${watchlistData.name || ''}">
                </td>
                <td>
                    <input type="datetime-local" class="input-field deadline-input" 
                           value="${deadlineDate ? deadlineDate.toISOString().slice(0, 16) : ''}">
                    ${deadlineDate ? 
                        `<div class="mt-1 text-sm">${formatDateTime(deadlineDate)}</div>` : 
                        ''}
                </td>
                <td class="text-center">
                    <span class="px-2 py-1 rounded ${watchlistData.completed ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'}">
                        ${watchlistData.completed ? 'Selesai' : 'Pending'}
                    </span>
                </td>
                <td class="text-center space-x-2">
                    <button class="btn ${watchlistData.completed ? 'btn-success' : 'btn-primary'} complete-btn">
                        ${watchlistData.completed ? '✓' : 'Selesai'}
                    </button>
                    <button class="btn btn-danger delete-btn">Hapus</button>
                </td>
            `;
            
            // Setup event listeners
            row.querySelector('.complete-btn').addEventListener('click', () => toggleWatchlistComplete(watchlistId, !watchlistData.completed));
            row.querySelector('.delete-btn').addEventListener('click', () => deleteWatchlist(watchlistId));
            row.querySelector('.watchlist-name').addEventListener('change', (e) => updateWatchlistName(watchlistId, e.target.value));
            row.querySelector('.deadline-input').addEventListener('change', (e) => updateWatchlistDeadline(watchlistId, e.target.value));
            
            return row;
        }

        // ================= OPERASI FIREBASE =================
        // Untuk Timer
        function saveTimerToFirebase(timerId, timerData) {
            return database.ref(`timers/${timerId}`).set(timerData);
        }

        function deleteTimerFromFirebase(timerId) {
            return database.ref(`timers/${timerId}`).remove();
        }

        // Untuk Watchlist
        function saveWatchlistToFirebase(watchlistId, watchlistData) {
            const dataToSave = {
                name: watchlistData.name || '',
                deadline: watchlistData.deadline || null,
                completed: watchlistData.completed || false,
                createdAt: watchlistData.createdAt || Date.now(),
                updatedAt: Date.now()
            };
            
            if (dataToSave.deadline && typeof dataToSave.deadline !== 'number') {
                dataToSave.deadline = new Date(dataToSave.deadline).getTime();
            }
            
            return database.ref(`watchlist/${watchlistId}`).set(dataToSave);
        }

        function deleteWatchlistFromFirebase(watchlistId) {
            return database.ref(`watchlist/${watchlistId}`).remove();
        }

        // ================= EVENT HANDLERS =================
        // Timer Handlers
        function addNewTimer() {
            const newTimerRef = database.ref('timers').push();
            const timerId = newTimerRef.key;
            
            const timerData = {
                name: 'Timer Baru',
                duration: 3600, // 1 jam default
                startTime: Date.now(),
                isRunning: false,
                createdAt: Date.now()
            };
            
            saveTimerToFirebase(timerId, timerData)
                .then(() => showAlert('Berhasil', 'Timer baru telah ditambahkan'))
                .catch(error => showAlert('Error', `Gagal menambah timer: ${error.message}`, 'error'));
        }

        function startTimer(timerId) {
            database.ref(`timers/${timerId}`).update({
                isRunning: true,
                startTime: Date.now()
            });
        }

        // ... (fungsi-fungsi lainnya untuk timer)

        // Watchlist Handlers
        function addNewWatchlist() {
            const newWatchlistRef = database.ref('watchlist').push();
            const watchlistId = newWatchlistRef.key;
            
            const watchlistData = {
                name: 'Task Baru',
                deadline: null,
                completed: false,
                createdAt: Date.now()
            };
            
            saveWatchlistToFirebase(watchlistId, watchlistData)
                .then(() => showAlert('Berhasil', 'Watchlist baru telah ditambahkan'))
                .catch(error => showAlert('Error', `Gagal menambah watchlist: ${error.message}`, 'error'));
        }

        function toggleWatchlistComplete(watchlistId, isCompleted) {
            database.ref(`watchlist/${watchlistId}`).update({
                completed: isCompleted,
                updatedAt: Date.now()
            });
        }

        // ... (fungsi-fungsi lainnya untuk watchlist)

        // ================= INISIALISASI =================
        document.addEventListener('DOMContentLoaded', function() {
            // Setup tombol
            document.getElementById('add-timer-btn').addEventListener('click', addNewTimer);
            document.getElementById('add-watchlist-btn').addEventListener('click', addNewWatchlist);
            
            // Setup konverter waktu
            document.getElementById('wib-to-utc').addEventListener('click', convertWIBtoUTC);
            document.getElementById('utc-to-wib').addEventListener('click', convertUTCtoWIB);
            
            // Update waktu saat ini
            function updateCurrentTime() {
                document.getElementById('current-time').textContent = formatDateTime(new Date());
            }
            updateCurrentTime();
            setInterval(updateCurrentTime, 1000);
            
            // Setup Firebase listeners
            // Untuk Timer
            database.ref('timers').on('value', (snapshot) => {
                const timers = snapshot.val() || {};
                const timerBody = document.getElementById('timer-body');
                timerBody.innerHTML = '';
                timerCount = 0;
                
                Object.entries(timers).forEach(([timerId, timerData]) => {
                    timerBody.appendChild(createTimerRow(timerId, timerData));
                });
            });
            
            // Untuk Watchlist
            database.ref('watchlist').on('value', (snapshot) => {
                const watchlists = snapshot.val() || {};
                const watchlistBody = document.getElementById('watchlist-body');
                watchlistBody.innerHTML = '';
                watchlistCount = 0;
                
                Object.entries(watchlists).forEach(([watchlistId, watchlistData]) => {
                    watchlistBody.appendChild(createWatchlistRow(watchlistId, watchlistData));
                });
            });
        });

        // ================= FUNGSI TAMBAHAN =================
        function convertWIBtoUTC() {
            const wibTime = document.getElementById('wib-time').value;
            if (!wibTime) {
                showAlert('Peringatan', 'Masukkan waktu WIB terlebih dahulu', 'warning');
                return;
            }
            
            const [hours, minutes] = wibTime.split(':').map(Number);
            let utcHours = hours - 7;
            if (utcHours < 0) utcHours += 24;
            
            document.getElementById('utc-time').value = 
                `${String(utcHours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            
            showAlert('Berhasil', 'Waktu WIB telah dikonversi ke UTC');
        }

        function convertUTCtoWIB() {
            const utcTime = document.getElementById('utc-time').value;
            if (!utcTime) {
                showAlert('Peringatan', 'Masukkan waktu UTC terlebih dahulu', 'warning');
                return;
            }
            
            const [hours, minutes] = utcTime.split(':').map(Number);
            let wibHours = hours + 7;
            if (wibHours >= 24) wibHours -= 24;
            
            document.getElementById('wib-time').value = 
                `${String(wibHours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}`;
            
            showAlert('Berhasil', 'Waktu UTC telah dikonversi ke WIB');
        }
    </script>
</body>
</html>
