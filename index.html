<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer Table</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .btn:active {
            transform: scale(0.95);
        }
        table, th, td {
            border: 1px solid #ddd;
            border-collapse: collapse;
        }
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        body {
            background: linear-gradient(270deg, #ff0000, #ff7f00, #ffff00, #00ff00, #0000ff, #4b0082, #8b00ff);
            background-size: 1400% 1400%;
            animation: rainbow 60s ease infinite;
        }
        #alarm-box {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: red;
            color: white;
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            display: none;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen">
    <div class="bg-white rounded-lg shadow-lg p-4 overflow-x-auto w-full max-w-7xl">
        <div class="text-center mb-4">
            <div id="date-time" class="text-lg font-semibold"></div>
        </div>
        <table class="min-w-full divide-y divide-gray-200" id="timer-table">
            <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">No</th>
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Nama</th>
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Timer</th>
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Mulai</th>
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Stop</th>
                    <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Hapus</th>
                </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
                </tbody>
        </table>
        <div class="mt-4 text-center">
            <button id="add-row-btn" class="bg-blue-500 text-white px-4 py-2 rounded">Tambah Tabel Baru</button>
        </div>
    </div>
    <audio id="alarm-sound" src="./alarm.mp3" preload="auto"></audio>
    <div id="alarm-box">Alarm</div>
    <script>
        }

        function playAlarm() {
            const alarmSound = document.getElementById('alarm-sound');
            const alarmBox = document.getElementById('alarm-box');
            alarmSound.play();
            alarmBox.style.display = 'block';

            alarmBox.addEventListener('click', () => {
                alarmSound.pause();
                alarmSound.currentTime = 0;
                alarmBox.style.display = 'none';
            });
        }

        function addEventListenersToRow(row) {
            const startButton = row.querySelector('.start-btn');
            const stopButton = row.querySelector('.stop-btn');
            const deleteButton = row.querySelector('.delete-btn');
            const timerElement = row.querySelector('.timer');
            const timerInput = row.querySelector('.timer-input');
            const nameInput = row.querySelector('input[type="text"]');
            const rowNumber = row.querySelector('td').textContent;

            let interval;

            startButton.addEventListener('click', () => {
                let [hours, minutes, seconds] = timerInput.value.split(':').map(Number);
                let totalSeconds = hours * 3600 + minutes * 60 + seconds;

                timerElement.textContent = timerInput.value;
                timerInput.classList.add('hidden');
                timerElement.classList.remove('hidden');

                interval = setInterval(() => {
                    if (totalSeconds <= 0) {
                        clearInterval(interval);
                        playAlarm(); // Panggil playAlarm() terlebih dahulu
                        showNotification(nameInput.value, rowNumber); // Kemudian panggil showNotification()
                        return;
                    }
                    totalSeconds--;
                    const h = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
                    const m = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
                    const s = String(totalSeconds % 60).padStart(2, '0');
                    timerElement.textContent = `${h}:${m}:${s}`;
                    saveTimerState(rowNumber, totalSeconds);
                }, 1000);

                startButton.disabled = true;
                startButton.classList.add('bg-green-500', 'text-white');
                stopButton.disabled = false;

                stopButton.addEventListener('click', () => {
                    clearInterval(interval);
                    startButton.disabled = false;
                    startButton.classList.remove('bg-green-500', 'text-white');
                    stopButton.disabled = true;
                    saveTimerState(rowNumber, totalSeconds);
                });
            });

            deleteButton.addEventListener('click', () => {
                row.remove();
                updateRowNumbers();
                saveTableState();
            });

            nameInput.addEventListener('input', saveTableState);
            timerElement.addEventListener('DOMSubtreeModified', saveTableState);
        }

        function updateRowNumbers() {
            document.querySelectorAll('#timer-table tbody tr').forEach((row, index) => {
                row.querySelector('td').textContent = index + 1;
            });
        }

        function saveTableState() {
            const rows = document.querySelectorAll('#timer-table tbody tr');
            const tableData = Array.from(rows).map(row => {
                return {
                    no: row.querySelector('td').textContent,
                    name: row.querySelector('input[type="text"]').value,
                    timer: row.querySelector('.timer').textContent,
                    startDisabled: row.querySelector('.start-btn').disabled,
                    stopDisabled: row.querySelector('.stop-btn').disabled
                };
            });
            localStorage.setItem('tableData', JSON.stringify(tableData));
        }

        function saveTimerState(rowNumber, totalSeconds) {
            const timerData = JSON.parse(localStorage.getItem('timerData')) || {};
            timerData[rowNumber] = totalSeconds;
            localStorage.setItem('timerData', JSON.stringify(timerData));
        }

        function loadTableState() {
            const tableData = JSON.parse(localStorage.getItem('tableData'));
            if (tableData) {
                tableData.forEach(data => {
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center">${data.no}</td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <input type="text" placeholder="Masukkan Nama" class="border border-gray-300 rounded px-2 py-1 w-full" value="${data.name}">
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <input type="text" placeholder="HH:MM:SS" class="border border-gray-300 rounded px-2 py-1 w-full timer-input" value="${data.timer}">
                            <div class="bg-gray-800 text-white text-center rounded px-4 py-2 timer text-lg hidden">${data.timer}</div>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <button class="bg-white border border-gray-300 rounded px-2 py-1 start-btn btn w-full" ${data.startDisabled ? 'disabled' : ''}>Mulai</button>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <button class="bg-gray-200 border border-gray-300 rounded px-2 py-1 stop-btn btn w-full" ${data.stopDisabled ? 'disabled' : ''}>Stop</button>
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-center">
                            <button class="bg-red-500 text-white border border-gray-300 rounded px-2 py-1 delete-btn btn w-full">Hapus</button>
                        </td>
                    `;
                    document.querySelector('#timer-table tbody').appendChild(newRow);
                    addEventListenersToRow(newRow);
                });
            }
        }

        function loadTimerState() {
            const timerData = JSON.parse(localStorage.getItem('timerData'));
            if (timerData) {
                Object.keys(timerData).forEach(rowNumber => {
                    const row = document.querySelector(`#timer-table tbody tr:nth-child(${rowNumber})`);
                    if (row) {
                        const timerElement = row.querySelector('.timer');
                        let totalSeconds = timerData[rowNumber];
                        const interval = setInterval(() => {
                            if (totalSeconds <= 0) {
                                clearInterval(interval);
                                return;
                            }
                            totalSeconds--;
                            const h = String(Math.floor(totalSeconds / 3600)).padStart(2, '0');
                            const m = String(Math.floor((totalSeconds % 3600) / 60)).padStart(2, '0');
                            const s = String(totalSeconds % 60).padStart(2, '0');
                            timerElement.textContent = `${h}:${m}:${s}`;
                            saveTimerState(rowNumber, totalSeconds);
                        }, 1000);

                        const startButton = row.querySelector('.start-btn');
                        const stopButton = row.querySelector('.stop-btn');

                        startButton.disabled = true;
                        startButton.classList.add('bg-green-500', 'text-white');
                        stopButton.disabled = false;

                        stopButton.addEventListener('click', () => {
                            clearInterval(interval);
                            startButton.disabled = false;
                            startButton.classList.remove('bg-green-500', 'text-white');
                            stopButton.disabled = true;
                            saveTimerState(rowNumber, totalSeconds);
                        });
                    }
                });
            }
        }

        function updateDateTime() {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', second: '2-digit', timeZone: 'Asia/Jakarta' };
            const formattedDateTime = now.toLocaleDateString('id-ID', options);
            document.getElementById('date-time').textContent = formattedDateTime;
        }

        document.getElementById('add-row-btn').addEventListener('click', () => {
            const tableBody = document.querySelector('#timer-table tbody');
            const rowCount = tableBody.rows.length + 1;
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 text-center">${rowCount}</td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                    <input type="text" placeholder="Masukkan Nama" class="border border-gray-300 rounded px-2 py-1 w-full">
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                    <input type="text" placeholder="HH:MM:SS" class="border border-gray-300 rounded px-2 py-1 w-full timer-input" value="24:00:00">
                    <div class="bg-gray-800 text-white text-center rounded px-4 py-2 timer text-lg hidden">24:00:00</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                    <button class="bg-white border border-gray-300 rounded px-2 py-1 start-btn btn w-full">Mulai</button>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                    <button class="bg-gray-200 border border-gray-300 rounded px-2 py-1 stop-btn btn w-full" disabled>Stop</button>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-center">
                    <button class="bg-red-500 text-white border border-gray-300 rounded px-2 py-1 delete-btn btn w-full">Hapus</button>
                </td>
            `;
            tableBody.appendChild(newRow);
            addEventListenersToRow(newRow);
            saveTableState();
        });

        window.addEventListener('beforeunload', saveTableState);
        window.addEventListener('load', () => {
            loadTableState();
            loadTimerState();
            updateDateTime();
            setInterval(updateDateTime, 1000);
        });

        document.addEventListener('click', function(event) {
            if (event.target.classList.contains('start-btn')) {
                const row = event.target.closest('tr');
                const timerInput = row.querySelector('.timer-input');
                const timerElement = row.querySelector('.timer');
                timerElement.textContent = timerInput.value;
                timerInput.classList.add('hidden');
                timerElement.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>