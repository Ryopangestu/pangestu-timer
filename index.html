<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Check-In Timer</title>
    <link rel="icon" href="https://raw.githubusercontent.com/[your-github-username]/[your-repo-name]/main/logo.jpg" type="image/jpg">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <style>
        .btn:active {
            transform: scale(0.95);
        }
        table, th, td {
            border: 1px solid #2d3748;
            border-collapse: collapse;
        }
        
        /* Background gradient */
        body {
            background: linear-gradient(135deg, #1e3a8a 0%, #4c1d95 100%);
        }
        
        /* Main container styling */
        .main-container {
            background: rgba(30, 41, 59, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Table header styling */
        .table-header {
            background-color: #1e293b;
        }
        
        /* Timer display styles */
        .timer-display-box {
            border: 2px solid #10b981;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            display: inline-block;
            min-width: 100px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            background-color: #ecfdf5;
            color: #047857;
        }
        
        /* Finish time display styles */
        .finish-time-box {
            border: 2px solid #10b981;
            border-radius: 0.5rem;
            padding: 0.5rem 1rem;
            display: inline-block;
            min-width: 150px;
            text-align: center;
            font-weight: bold;
            background-color: #ecfdf5;
            color: #047857;
        }
        
        /* Name input styles */
        .name-input {
            border: 1px solid #374151;
            border-radius: 0.375rem;
            padding: 0.5rem;
            width: 100%;
            min-width: 150px;
            background-color: #1f2937;
            color: white;
        }
        
        /* Dark mode styles - keeping for compatibility */
        .dark .timer-display-box {
            border-color: #6ee7b7;
            background-color: #064e3b;
            color: #d1fae5;
        }
        .dark .finish-time-box {
            border-color: #6ee7b7;
            background-color: #064e3b;
            color: #d1fae5;
        }
        .dark .name-input {
            border-color: #4b5563;
            background-color: #374151;
            color: #f3f4f6;
        }
        
        /* Title styling */
        .table-title {
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
            text-align: center;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        /* Logo styling */
        .logo-container {
            text-align: center;
            margin-bottom: 1rem;
        }
        .logo {
            height: 80px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="min-h-screen">
    <div class="main-container rounded-lg shadow-lg p-4 mx-auto my-4 w-full max-w-7xl">
        <!-- Logo -->
        <div class="logo-container">
            <img src="https://raw.githubusercontent.com/[your-github-username]/[your-repo-name]/main/logo.jpg" alt="Company Logo" class="logo mx-auto">
        </div>
        
        <!-- Title -->
        <h1 class="table-title">DAILY CHECK-IN TIMER</h1>
        
        <div class="text-center mb-4">
            <div id="date-time" class="text-lg font-semibold text-white"></div>
        </div>
        
        <div class="table-container overflow-x-auto mb-4 max-h-[60vh]">
            <table class="min-w-full divide-y divide-gray-200" id="timer-table">
                <thead class="table-header sticky top-0">
                    <tr>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-200 uppercase tracking-wider">No</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-200 uppercase tracking-wider">Nama</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-200 uppercase tracking-wider">Set Timer</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-200 uppercase tracking-wider">Timer Berjalan</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-200 uppercase tracking-wider">Selesai Pada</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-200 uppercase tracking-wider">Mulai</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-200 uppercase tracking-wider">Stop</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-200 uppercase tracking-wider">Restart</th>
                        <th class="px-4 py-3 text-center text-xs font-medium text-gray-200 uppercase tracking-wider">Hapus</th>
                    </tr>
                </thead>
                <tbody class="bg-slate-800 divide-y divide-gray-700">
                    <!-- Rows will be added dynamically -->
                </tbody>
            </table>
        </div>

        <div class="text-center mb-4">
            <button id="add-row-btn" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded transition duration-200 shadow-lg">
                Tambah Tabel Baru
            </button>
        </div>

        <div class="converter-container bg-slate-800 rounded-lg p-4 mt-4 shadow-lg">
            <div class="converter-title text-lg font-bold mb-2 text-white">Konverter Waktu WIB ⇄ UTC</div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300">Waktu WIB</label>
                    <input type="time" id="wib-time" class="time-input border border-gray-600 rounded px-3 py-2 w-full bg-slate-700 text-white" step="1">
                    <button id="wib-to-utc" class="converter-btn bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded w-full mt-1 transition duration-200">
                        WIB → UTC
                    </button>
                </div>
                <div class="flex items-center justify-center">
                    <div class="text-2xl font-bold mt-6 text-white">⇄</div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300">Waktu UTC</label>
                    <input type="time" id="utc-time" class="time-input border border-gray-600 rounded px-3 py-2 w-full bg-slate-700 text-white" step="1">
                    <button id="utc-to-wib" class="converter-btn bg-green-500 hover:bg-green-600 text-white px-3 py-2 rounded w-full mt-1 transition duration-200">
                        UTC → WIB
                    </button>
                </div>
            </div>
            <div class="mt-2 text-sm text-gray-400">
                * WIB (Waktu Indonesia Barat) = UTC+7
            </div>
        </div>
    </div>
    
    <!-- The rest of your JavaScript code remains exactly the same -->
    <script>
        // [Your existing JavaScript code remains unchanged]
        // Only replace the logo URL with your actual GitHub username and repo name
        const firebaseConfig = {
            apiKey: "AIzaSyDXjv3Yg8RJvxCrYYZvMjpEKSdxcshynTo",
            authDomain: "pangestu-timer.firebaseapp.com",
            databaseURL: "https://pangestu-timer-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "pangestu-timer",
            storageBucket: "pangestu-timer.appspot.com",
            messagingSenderId: "423055274704",
            appId: "1:423055274704:web:3e9e438bc18439012364d5",
            measurementId: "G-0249BJFL8T"
        };

        // [Rest of your existing JavaScript code...]
        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        const activeIntervals = {};
        const shownNotifications = new Set();
        const timerStates = {}; // Untuk menyimpan state timer

        function showNotification(title, message, icon = 'info', timer = 3000) {
            return Swal.fire({
                title: title,
                text: message,
                icon: icon,
                timer: timer,
                timerProgressBar: true,
                showConfirmButton: false,
                position: 'top-end',
                toast: true,
                background: document.documentElement.classList.contains('dark') ? '#1f2937' : '#f8f9fa',
                color: document.documentElement.classList.contains('dark') ? '#f3f4f6' : '#333',
                width: '400px'
            });
        }

        // [Continue with all your existing functions...]
        // Make sure to keep all your existing timer functionality

        document.addEventListener('DOMContentLoaded', function() {
            // [Your existing initialization code...]
            listenForTimerChanges((timers) => {
                const tableBody = document.querySelector('#timer-table tbody');
                tableBody.innerHTML = '';
                
                if (timers) {
                    Object.entries(timers).forEach(([rowNumber, timerData]) => {
                        const newRow = createNewRow(rowNumber, timerData);
                        tableBody.appendChild(newRow);
                        addEventListenersToRow(newRow);
                        
                        // Initialize timer state from Firebase data
                        if (timerData.isRunning) {
                            const timerDisplay = newRow.querySelector('.timer-display-box');
                            const startButton = newRow.querySelector('.start-btn');
                            const stopButton = newRow.querySelector('.stop-btn');
                            const finishTimeBox = newRow.querySelector('.finish-time-box');
                            
                            // Calculate remaining time
                            const timeElapsed = timerData.timestamp ? 
                                Math.floor((Date.now() - timerData.timestamp) / 1000) : 0;
                            let remainingSeconds = Math.max(0, (timerData.remainingSeconds || 0) - timeElapsed);
                            
                            // Update timer state
                            timerStates[rowNumber] = {
                                isRunning: true,
                                remainingSeconds: remainingSeconds,
                                finishTime: timerData.finishTime ? new Date(timerData.finishTime) : null
                            };
                            
                            // Update UI
                            startButton.disabled = true;
                            startButton.classList.add('bg-green-500', 'text-white');
                            stopButton.disabled = false;
                            
                            if (timerData.finishTime) {
                                finishTimeBox.textContent = formatFinishTime(new Date(timerData.finishTime));
                                finishTimeBox.classList.remove('hidden');
                            }
                            
                            const updateTimer = async () => {
                                if (remainingSeconds <= 0) {
                                    clearInterval(activeIntervals[rowNumber]);
                                    delete activeIntervals[rowNumber];
                                    
                                    timerStates[rowNumber].isRunning = false;
                                    timerStates[rowNumber].remainingSeconds = 0;
                                    timerStates[rowNumber].finishTime = null;
                                    
                                    await saveTimerToFirebase(rowNumber, {
                                        name: timerData.name,
                                        timer: '00:00:00',
                                        timerInputValue: timerData.timerInputValue,
                                        startDisabled: false,
                                        stopDisabled: true,
                                        restartDisabled: false,
                                        timerVisible: false,
                                        isRunning: false,
                                        remainingSeconds: 0,
                                        finishTime: null
                                    });

                                    finishTimeBox.classList.add('hidden');

                                    if (!shownNotifications.has(rowNumber)) {
                                        shownNotifications.add(rowNumber);
                                        showNotification(
                                            'Timer Selesai', 
                                            `Timer #${rowNumber} (${timerData.name || 'Tanpa Nama'}) telah berhenti`, 
                                            'info'
                                        );
                                    }
                                    
                                    return;
                                }
                                
                                timerStates[rowNumber].remainingSeconds = remainingSeconds - 1;
                                const h = String(Math.floor(timerStates[rowNumber].remainingSeconds / 3600)).padStart(2, '0');
                                const m = String(Math.floor((timerStates[rowNumber].remainingSeconds % 3600) / 60)).padStart(2, '0');
                                const s = String(timerStates[rowNumber].remainingSeconds % 60).padStart(2, '0');
                                timerDisplay.textContent = `${h}:${m}:${s}`;
                                remainingSeconds--;
                            };
                            
                            const h = String(Math.floor(remainingSeconds / 3600)).padStart(2, '0');
                            const m = String(Math.floor((remainingSeconds % 3600) / 60)).padStart(2, '0');
                            const s = String(remainingSeconds % 60).padStart(2, '0');
                            timerDisplay.textContent = `${h}:${m}:${s}`;
                            timerDisplay.classList.remove('hidden');
                            
                            activeIntervals[rowNumber] = setInterval(updateTimer, 1000);
                        } else if (timerData.remainingSeconds > 0) {
                            // Timer is paused
                            timerStates[rowNumber] = {
                                isRunning: false,
                                remainingSeconds: timerData.remainingSeconds,
                                finishTime: timerData.finishTime ? new Date(timerData.finishTime) : null
                            };
                            
                            const timerDisplay = newRow.querySelector('.timer-display-box');
                            const h = String(Math.floor(timerData.remainingSeconds / 3600)).padStart(2, '0');
                            const m = String(Math.floor((timerData.remainingSeconds % 3600) / 60)).padStart(2, '0');
                            const s = String(timerData.remainingSeconds % 60).padStart(2, '0');
                            timerDisplay.textContent = `${h}:${m}:${s}`;
                            timerDisplay.classList.remove('hidden');
                            
                            if (timerData.finishTime) {
                                const finishTimeBox = newRow.querySelector('.finish-time-box');
                                finishTimeBox.textContent = formatFinishTime(new Date(timerData.finishTime));
                                finishTimeBox.classList.remove('hidden');
                            }
                        }
                    });
                }
            });

            document.getElementById('add-row-btn').addEventListener('click', addNewRow);
            document.getElementById('wib-to-utc').addEventListener('click', convertWIBtoUTC);
            document.getElementById('utc-to-wib').addEventListener('click', convertUTCtoWIB);
            document.getElementById('wib-time').addEventListener('input', convertWIBtoUTC);
            document.getElementById('utc-time').addEventListener('input', convertUTCtoWIB);
            
            const now = new Date();
            const wibTimeInput = document.getElementById('wib-time');
            wibTimeInput.value = `${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}`;
            convertWIBtoUTC();
            
            updateDateTime();
            setInterval(updateDateTime, 1000);
        });
    </script>
</body>
</html>
